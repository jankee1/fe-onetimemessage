<div class="create-message" *ngIf="!showStatus">
    <form [formGroup]="messageForm" (ngSubmit)="onSubmit()" >  
        <div class="form-group optional-data-btn">
            <button type="button" class="btn btn-primary p-3" (click)="toggleOptionalFields()"> {{optionalFieldsVisible ? 'Hide' : 'Show'}} optional fields</button>
        </div>

        <div class="optional-data" [hidden]="!optionalFieldsVisible">
            <div class="email">
                <label for="emailRecipient" class="form-label font-weight-bold font-size">Email recipient</label>
                <input class="bg-dark text-light opacity form-control" type="email" id="emailRecipient" formControlName="emailRecipient">
            </div>
            <div class="date">
                <label for="meetingDate" class="form-label font-weight-bold font-size">Meeting date</label>
                <input type="datetime-local" formControlName="meetingDate" name="meetingDate" id="meetingDate"
                class="bg-dark text-light opacity form-control" min={{today}} max={{fiveDaysFromNow}}>
            </div>
            <div class="place">
                <label for="meetingPlace" class="form-label font-weight-bold font-size">Meeting place</label>
                 <p-dropdown 
                    [disabled]="!isMeetingDateSet" 
                    [(ngModel)]="selectedCity"
                    [ngModelOptions]="{standalone: true}"
                    styleClass="bg-dark text-light opacity mobile-padding"
                    [options]="cityViews$ | async"
                    [filter]="true"
                    filterBy="cityName" 
                    [showClear]="true"
                    (onFilter)="search($event)"
                    placeholder="Type city name"
                    emptyFilterMessage="{{moviesLoading ? 'Loading...' : 'No results found'}}"
                >
                        <ng-template let-selectedOption pTemplate="selectedItem" >
                            <div class="flex align-items-center gap-2">
                                <div class="text-light">
                                    {{ selectedOption.cityName }}, {{ selectedOption.countyName }}
                                </div>
                            </div>
                        </ng-template>
                        <ng-template let-cityView pTemplate="item">
                            <div class="flex align-items-center gap-2">
                                <h6 class="font-weight-bold">City</h6>
                                <div class="text-wrap">{{ cityView.cityName }}, {{ cityView.countyName }}, {{ cityView.countryName }}</div>
                                <h6 class="font-weight-bold">Temperature</h6>
                                <div class="w-100">{{ cityView.minTemp }}&deg;C - {{ cityView.maxTemp }}&deg;C</div>
                            </div>
                        </ng-template>
                </p-dropdown>
            </div>
        </div>

        <div class="pt-4 pb-3 form-group message-body">
            <label for="messageBody" class="font-weight-bold font-size">Messge:</label>
            <textarea class="form-control bg-dark text-light opacity p-4" name="messageBody" id="messageBody" cols="30" rows="10" formControlName="messageBody" placeholder="Type your message here"></textarea>    
        </div>

        <div class="d-flex justify-content-sm-around form-btns">
            <button type="button" class="btn btn-primary p-3" (click)="clearForm()">Clear all fields</button>
            <button type="submit" class="btn p-3" [ngClass]="messageForm.invalid ? 'btn-danger' : 'btn-primary'" [disabled]="messageForm.invalid">Send message</button>
        </div>
    </form>
</div>
<div class="mt-5 p-30" *ngIf="showStatus">
    <status-message 
        [status]="getStatus()" 
        (statusUpdateEvent)="onStatusUpdate($event)">
    </status-message>
</div>